<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/app.css') }}">
  <script defer src="{{ url_for('static', filename='js/app.js') }}"></script>
  <title>Index</title>
</head>
<body>
{% include "_banner.html" %}

<div class="page">
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash">
        {% for m in messages %}<div>{{ m }}</div>{% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% if page_mode == 'info' %}
    {% include "_info_content.html" %}
  {% else %}
    <div class="card">
      <div class="tabs">
        {% for key, m in OBJECT_TYPES.items() %}
          <a class="tab {% if key == otype %}active{% endif %}" href="{{ url_for('index', type=key) }}">{{ m.label }}</a>
        {% endfor %}
      </div>

      {% if not index_fields %}
        <div style="margin-top:12px;" class="meta">
          No index fields are configured for this object type. Add an
          <code>index</code> list in <code>config.py</code> (e.g. <code>'index': ['temper','typology']</code>).
        </div>
      {% else %}
        <div class="actions" style="margin-top:10px; flex-wrap:wrap;">
          {% for f in index_fields %}
            {% set lbl = meta.field_meta.get(f, {}).get('label') or f %}
            <a class="btn {% if f == field %}primary{% endif %}" href="{{ url_for('index', type=otype, field=f) }}">{{ lbl }}</a>
          {% endfor %}
        </div>

        <div style="margin-top:14px;">
          {% for val, recs in groups %}
            <div class="card" style="margin-bottom:12px;">
              <div style="display:flex; justify-content:space-between; gap:10px; align-items:baseline; flex-wrap:wrap;">
                <div style="font-weight:800;">{{ val }}</div>
                <div class="meta">{{ recs|length }} record(s)</div>
              </div>

              <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">
                {% for r in recs %}
                  <div class="card" style="min-width:260px; flex:1 1 360px;">
                    {% set mode = 'index' %}
                    {% set show_recent_edit_btn = False %}
                    {% set edit_form_id = '' %}
                    {% include "_record_card.html" %}
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% endif %}
</div>

</body>
</html>
