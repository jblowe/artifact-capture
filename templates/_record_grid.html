{# Grid renderer: images grid + hanging-indent text from meta.result_grid #}
{% set images = (r['images_json']|fromjson) if ('images_json' in r.keys() and r['images_json']) else [] %}
{% set thumbs = (r['thumbs_json']|fromjson) if ('thumbs_json' in r.keys() and r['thumbs_json']) else [] %}

<div class="grid-card">
  <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:6px;">
    <div class="mono"><strong>{{ r['id'] }}</strong></div>
    <a class="btn" style="padding:3px 8px; font-size:12px;" href="{{ url_for('admin_edit', otype=otype, aid=r['id']) }}">Edit</a>
  </div>
  <div class="grid-images">
    {% if thumbs %}
      {% for t in thumbs %}
        {% set href = (images[loop.index0] if images and (images|length > loop.index0) else t) %}
        <a href="{{ url_for('serve_upload', fname=href) }}" target="_blank" title="{{ href }}">
          <img class="thumb" src="{{ url_for('serve_upload', fname=t) }}" alt="thumb">
        </a>
      {% endfor %}
    {% elif images %}
      {% for img in images %}
        <a href="{{ url_for('serve_upload', fname=img) }}" target="_blank" title="{{ img }}">
          <img class="thumb" src="{{ url_for('serve_upload', fname=img) }}" alt="image">
        </a>
      {% endfor %}
    {% else %}
      <img class="grid-placeholder" src="{{ url_for('static', filename='images/placeholder.png') }}" alt="(no image)">
    {% endif %}
  </div>

  {% set fields = meta.get('result_grid') or [] %}
  {% if fields %}
    {% set parts = [] %}
    {% for f in fields %}
      {% if f in r.keys() and r[f] %}
        {% set _ = parts.append(r[f]|string) %}
      {% endif %}
    {% endfor %}
    {% if parts %}
      <p class="grid-text">{{ parts|join(' Â· ') }}</p>
    {% endif %}
  {% endif %}
</div>