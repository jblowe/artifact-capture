{#
  Review page body.
  Rendered inside index.html so it inherits the shared <head>/banner/styles.

  Expected vars (provided by /review route):
  - otype, meta, index_fields, field, view
  - rows, page, per_page, per_page_choices, total, start_n, end_n, has_prev, has_next, prev_q, next_q
  - OBJECT_TYPES
#}

<div class="card">
  <div class="tabs">
    {% for key, m in OBJECT_TYPES.items() %}
      <a class="tab {% if key == otype %}active{% endif %}" href="{{ url_for('review', type=key) }}">{{ m.label }}</a>
    {% endfor %}
  </div>

  {% if not index_fields %}
    <div style="margin-top:12px;" class="meta">
      No review fields are configured for this object type. Add an
      <code>index</code> list in <code>config.py</code> (e.g. <code>'index': ['temper','typology']</code>).
    </div>
  {% else %}
    <div class="actions" style="margin-top:10px; flex-wrap:wrap;">
      {% for f in index_fields %}
        {% set lbl = meta.field_meta.get(f, {}).get('label') or f %}
        <a class="btn {% if f == field %}primary{% endif %}"
           href="{{ url_for('review', type=otype, field=f, view=view, page=1, per_page=per_page) }}">{{ lbl }}</a>
      {% endfor %}
    </div>

    <div style="display:flex; justify-content:flex-end; align-items:center; gap:10px; margin-top:10px; flex-wrap:wrap;">
      <div class="meta" style="white-space:nowrap;">
        {% if has_prev %}
          <a href="{{ url_for('review', **prev_q) }}">« Previous</a>
        {% else %}
          <span style="opacity:.5;">« Previous</span>
        {% endif %}
        &nbsp;|&nbsp;
        {{ start_n }} - {{ end_n }} of {{ total }}
        &nbsp;|&nbsp;
        {% if has_next %}
          <a href="{{ url_for('review', **next_q) }}">Next »</a>
        {% else %}
          <span style="opacity:.5;">Next »</span>
        {% endif %}
      </div>

      <form method="get" action="{{ url_for('review') }}" style="display:inline-flex; align-items:center; gap:6px; margin:0;">
        <input type="hidden" name="type" value="{{ otype }}">
        <input type="hidden" name="field" value="{{ field }}">
        <input type="hidden" name="view" value="{{ view }}">
        <input type="hidden" name="page" value="1">
        <select name="per_page" onchange="this.form.submit()">
          {% for n in per_page_choices %}
            <option value="{{ n }}" {% if per_page == n %}selected{% endif %}>{{ n }}</option>
          {% endfor %}
        </select>
        <span class="meta">per page</span>
      </form>

      <div style="display:inline-flex; gap:6px;">
        <a class="btn {% if view == 'para' %}primary{% endif %}"
           href="{{ url_for('review', type=otype, field=field, view='para', page=page, per_page=per_page) }}">paragraph</a>
        <a class="btn {% if view == 'table' %}primary{% endif %}"
           href="{{ url_for('review', type=otype, field=field, view='table', page=page, per_page=per_page) }}">table</a>
        <a class="btn {% if view == 'grid' %}primary{% endif %}" href="{{ url_for('review', type=otype, field=field, view='grid', page=page, per_page=per_page) }}">grid</a>
      </div>
    </div>
{% if view == 'table' %}
  {% if groups %}
    {% for gval, grows in groups %}
      <h3 style="margin:14px 0 6px 0;">{{ gval }}</h3>
      {% set table_rows = grows %}
      {% include "_record_table.html" %}
    {% endfor %}
  {% else %}
    {% include "_record_table.html" %}
  {% endif %}
{% elif view == 'grid' %}
  {% if groups %}
    {% for gval, grows in groups %}
      <h3 style="margin:14px 0 6px 0;">{{ gval }}</h3>
      <div class="grid-wrap">
        {% for r in grows %}
          {% include "_record_grid.html" %}
        {% endfor %}
      </div>
    {% endfor %}
  {% else %}
    <div class="grid-wrap">
      {% for r in rows %}
        {% include "_record_grid.html" %}
      {% endfor %}
    </div>
  {% endif %}
{% else %}
  {% if groups %}
    {% for gval, grows in groups %}
      <h3 style="margin:14px 0 6px 0;">{{ gval }}</h3>
      {% for r in grows %}
        <div class="card" style="margin-top:12px;">
          {% set mode = 'review' %}
          {% set show_recent_edit_btn = False %}
          {% set edit_form_id = '' %}
          {% include "_record_card.html" %}
        </div>
      {% endfor %}
    {% endfor %}
  {% else %}
    {% for r in rows %}
      <div class="card" style="margin-top:12px;">
        {% set mode = 'review' %}
        {% set show_recent_edit_btn = False %}
        {% set edit_form_id = '' %}
        {% include "_record_card.html" %}
      </div>
    {% endfor %}
  {% endif %}
{% endif %}

  {% endif %}
</div>
